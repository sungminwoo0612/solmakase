# 3. 업무 흐름도

---

## 3.1 통합 업무 흐름도

### 전체 프로세스 흐름

```
[사용자]
    │
    ├─→ [1. 요구사항 입력]
    │       │
    │       ├─→ 설문조사 입력
    │       ├─→ 문서 업로드 (PDF, docx, pptx, 한글)
    │       ├─→ 채팅 입력
    │       └─→ 전문가 모드
    │
    ├─→ [2. 요구사항 분석]
    │       │
    │       ├─→ 문서 파싱 (파일 서비스)
    │       ├─→ RAG 기반 문서 분석
    │       ├─→ Agent LLM 요구사항 추출
    │       └─→ 구조화된 데이터 생성
    │
    ├─→ [3. 분석 결과 확인]
    │       │
    │       ├─→ 요구사항 요약 확인
    │       ├─→ 추출된 정보 검토
    │       └─→ 추가 질문/수정 요청 (필요시 1단계로)
    │
    ├─→ [4. 인프라 설계]
    │       │
    │       ├─→ 온프레미스 설계안 생성
    │       ├─→ 클라우드 설계안 생성
    │       ├─→ 비용 산정
    │       └─→ 설계안 비교 및 선택
    │
    ├─→ [5. IaC 코드 생성]
    │       │
    │       ├─→ Terraform 코드 생성
    │       ├─→ Ansible 코드 생성 (선택)
    │       ├─→ Kubernetes Manifest 생성 (선택)
    │       ├─→ 코드 검증
    │       └─→ 코드 최적화
    │
    ├─→ [6. 코드 수정 (선택)]
    │       │
    │       ├─→ 프롬프트 기반 수정 요청
    │       ├─→ 변경사항 미리보기
    │       └─→ 적용 확인 (필요시 5단계로)
    │
    ├─→ [7. 배포 실행]
    │       │
    │       ├─→ 배포 승인
    │       ├─→ IaC 코드 실행 (Terraform apply)
    │       ├─→ 배포 상태 추적
    │       └─→ 배포 완료 알림
    │
    ├─→ [8. 모니터링 및 관리]
    │       │
    │       ├─→ 인프라 구조 시각화 (React Flow)
    │       ├─→ 리소스 상태 모니터링
    │       ├─→ 메트릭 수집 및 표시
    │       ├─→ 네트워크 연결 테스트
    │       └─→ 비용 추적
    │
    └─→ [9. 결과물 다운로드]
            │
            ├─→ IaC 코드 다운로드
            ├─→ 인프라 기획서 다운로드
            └─→ 견적서 다운로드
```

### 주요 프로세스 단계

1. **요구사항 입력 단계**
   - 사용자가 다양한 방식으로 요구사항 입력
   - 입력 방식: 설문조사, 문서 업로드, 채팅, 전문가 모드

2. **요구사항 분석 단계**
   - 문서 파싱 및 텍스트 추출
   - RAG를 통한 지식 베이스 검색
   - Agent LLM을 통한 요구사항 구조화

3. **인프라 설계 단계**
   - 온프레미스/클라우드 각각 설계안 생성
   - 비용 산정 및 비교
   - 사용자 선택 및 확인

4. **IaC 코드 생성 단계**
   - 설계안 기반 IaC 코드 자동 생성
   - 코드 검증 및 최적화
   - 버전 관리

5. **배포 및 모니터링 단계**
   - 실제 인프라 배포
   - 실시간 모니터링 및 관리
   - 테스트 및 검증

---

## 3.2 애플리케이션 아키텍처

### 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 (브라우저)                          │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ HTTP/WebSocket
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                    프론트엔드 (React + TypeScript)                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ 요구사항 입력 │  │ 인프라 대시보드│  │ 모니터링 화면 │          │
│  │   컴포넌트    │  │ (React Flow) │  │   컴포넌트    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             │ REST API
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                    백엔드 (FastAPI)                               │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    API 라우터                              │   │
│  │  - /api/v1/requirements  (요구사항 수집)                  │   │
│  │  - /api/v1/analysis      (분석 결과)                      │   │
│  │  - /api/v1/infrastructure (인프라 관리)                   │   │
│  │  - /api/v1/deployment    (배포 관리)                      │   │
│  │  - /api/v1/monitoring    (모니터링)                       │   │
│  └──────────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    서비스 레이어                            │   │
│  │  - File Service      (파일 업로드/파싱)                    │   │
│  │  - LLM Service       (LLM 연동)                           │   │
│  │  - IaC Service       (코드 생성)                          │   │
│  │  - Deployment Service (배포 실행)                         │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────┬──────────────┬──────────────┬──────────────┬──────────────┘
      │              │              │              │
      │              │              │              │
┌─────▼──────┐ ┌─────▼──────┐ ┌─────▼──────┐ ┌─────▼──────┐
│ PostgreSQL │ │   Redis    │ │  LLM/RAG   │ │   IaC      │
│  (메인 DB)  │ │  (캐시)    │ │   서비스    │ │  서비스     │
└────────────┘ └────────────┘ └─────┬──────┘ └─────┬──────┘
                                     │              │
                          ┌──────────┴──────────┐  │
                          │                     │  │
                    ┌─────▼──────┐      ┌──────▼──▼──────┐
                    │  LangChain │      │   Terraform    │
                    │  LangGraph │      │   Ansible      │
                    │  OpenAI    │      │   Kubernetes   │
                    │  ChromaDB  │      └────────────────┘
                    └────────────┘
                                     │
                          ┌──────────┴──────────┐
                          │                     │
                    ┌─────▼──────┐      ┌──────▼──────┐
                    │  Prometheus│      │   Grafana   │
                    │  (메트릭)  │      │  (시각화)   │
                    └────────────┘      └─────────────┘
                                     │
                          ┌──────────┴──────────┐
                          │                     │
                    ┌─────▼──────┐      ┌──────▼──────┐
                    │   AWS      │      │   Azure     │
                    │   GCP      │      │   On-Prem   │
                    │  (클라우드) │      │  (온프레미스) │
                    └────────────┘      └─────────────┘
```

### 레이어별 구성

#### 1. 프레젠테이션 레이어 (Frontend)
- **기술**: React 18.x+, TypeScript 5.x+, React Flow 11.x+, Tailwind CSS 3.x+
- **주요 컴포넌트**:
  - 요구사항 입력 컴포넌트
  - 인프라 시각화 대시보드 (React Flow)
  - 모니터링 화면 컴포넌트
- **통신**: REST API, WebSocket (실시간 업데이트)

#### 2. 애플리케이션 레이어 (Backend)
- **기술**: FastAPI 0.104+, Python 3.10+, Pydantic 2.x+
- **주요 모듈**:
  - API 라우터: RESTful API 엔드포인트
  - 서비스 레이어: 비즈니스 로직 처리
  - 파일 서비스: 문서 업로드 및 파싱
  - LLM 서비스: RAG 및 Agent LLM 연동
  - IaC 서비스: 코드 생성 및 검증
  - 배포 서비스: 인프라 배포 관리

#### 3. 데이터 레이어
- **PostgreSQL**: 메인 데이터베이스 (사용자 정보, 요구사항, 인프라 설계 등)
- **Redis**: 캐싱 및 세션 관리
- **ChromaDB/FAISS**: 벡터 데이터베이스 (RAG 지식 베이스)

#### 4. AI/LLM 레이어
- **LangChain**: LLM 워크플로우 오케스트레이션
- **LangGraph**: 복잡한 LLM 워크플로우 그래프
- **OpenAI/Claude API**: LLM 모델 호출
- **RAG 시스템**: 지식 베이스 검색 및 컨텍스트 생성

#### 5. 인프라 자동화 레이어
- **Terraform**: 인프라 코드 생성 및 배포
- **Ansible**: 구성 관리 (선택)
- **Kubernetes**: 컨테이너 오케스트레이션 (선택)

#### 6. 모니터링 레이어
- **Prometheus**: 메트릭 수집
- **Grafana**: 시각화 대시보드

#### 7. 인프라 레이어
- **클라우드**: AWS, Azure, GCP
- **온프레미스**: 사용자 자체 인프라

### 데이터 흐름

1. **요구사항 수집 흐름**
   ```
   사용자 입력 → 프론트엔드 → API → 파일 서비스 → DB 저장
   ```

2. **분석 흐름**
   ```
   DB 조회 → LLM 서비스 → RAG 검색 → Agent LLM 분석 → 구조화된 데이터 → DB 저장
   ```

3. **설계 및 코드 생성 흐름**
   ```
   구조화된 데이터 → LLM 서비스 (설계) → IaC 서비스 (코드 생성) → 코드 검증 → DB 저장
   ```

4. **배포 흐름**
   ```
   사용자 승인 → 배포 서비스 → Terraform 실행 → 클라우드/온프레미스 배포 → 상태 업데이트
   ```

5. **모니터링 흐름**
   ```
   Prometheus 수집 → Grafana 시각화 → API 조회 → 프론트엔드 표시
   ```

